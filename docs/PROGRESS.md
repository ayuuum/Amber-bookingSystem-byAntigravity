# Amber プロジェクト進捗管理

> **最終更新日**: 2026-01-02  
> **参照**: [PRD (docs/prd.md)](prd.md) Section 11, 12

## 📊 全体進捗サマリー

| Phase | ステータス | 進捗率 | 備考 |
|:---|:---|:---:|:---|
| Phase 0: Core MVP | ✅ 完了 | 100% | 予約データ保存の基本機能 |
| Phase 1.1: Multi-tenant Scaling | 🔄 進行中 | ~85% | 店舗・予約・顧客管理の基本機能 |
| Phase 1.2A: LINE LIFF統合 | 🔄 進行中 | ~90% | 実装完了、設定待ち |
| Phase 1.2: Fintech & Communication Loop | ⏳ 未着手 | 0% | 将来実装 |
| Phase 2.0: AI-Native FSM | ⏳ 未着手 | 0% | 将来実装 |

**Must Have機能の進捗**: 約 95% 完了

---

## ⚠️ 設定待ち項目（要対応）

> **注意**: 以下の設定が完了していないため、一部機能が利用できません。

| 機能 | 設定項目 | ステータス | 優先度 | 手順・参照 |
|:---|:---|:---:|:---:|:---|
| **LINE LIFF統合** | 環境変数 `NEXT_PUBLIC_LIFF_ID` の設定 | ❌ 未設定 | 🔴 高 | [PRD Section 4-4-B](prd.md#4-4-b-line-liff統合phase-12a), [環境変数一覧](prd.md#10-6-環境変数一覧) |
| **LINE LIFF統合** | LINE DevelopersでのLIFFアプリ作成 | ❌ 未設定 | 🔴 高 | [PRD Section 4-4-B](prd.md#4-4-b-line-liff統合phase-12a) |
| **LINE LIFF統合** | リッチメニューの設定 | ❌ 未設定 | 🔴 高 | [PRD Section 4-4-B](prd.md#4-4-b-line-liff統合phase-12a) |
| **LINE LIFF統合** | データベースマイグレーション実行 | ❌ 未実行 | 🔴 高 | `supabase/migrations/20260102_line_liff_integration.sql` |
| **リマインド通知** | Cronジョブの設定 | ❌ 未設定 | 🟡 中 | [PRD Section 4-4](prd.md#4-4-通知機能) |

**合計**: 5項目（高優先度: 4項目、中優先度: 1項目）

> 💡 **設定手順**: 各項目の「手順・参照」列のリンクから詳細を確認できます。

---

## 🗺️ Phase別進捗

### Phase 0: Core MVP [Done] ✅

- [x] 予約データの保存成功率 100%
- [x] 手書きメモの完全廃止

**完了日**: 2024-12-15

---

### Phase 1.1: Multi-tenant Scaling [Current] 🔄

**目的**: 店舗・予約・顧客管理の基本。Stripe 決済連携。

#### 完了定義 (DoD)

- [x] 5店舗×スタッフ10名規模での7日間連続無障害運用
- [x] 予約・空き枠計算API応答時間 P95 < 200ms
- [x] 決済成功率 > 99% (Stripe等外部要因除く)

#### v1.3 実装済み機能

- [x] 白黒をメインとしたシンプルなデザインの実装
- [x] ルートパス（`/`）を予約ページとして実装（最初のストアを自動取得）
- [x] 管理画面の日本語化（サイドバー、ダッシュボード、予約一覧等）
- [x] エラーハンドリングの改善（詳細なエラーメッセージ、ログ出力）
- [x] パフォーマンス最適化（データベースインデックスの追加、クエリ最適化）
- [x] 開発用データシード機能（`/api/test/seed`）
- [x] RLSポリシーの最適化（`profiles`テーブルベースのアクセス制御）
- [x] HQ機能のUI実装（分析ダッシュボード、請求管理、店舗管理）
- [x] リテンション分析UI（顧客維持率、LTV分析）
- [x] 招待管理UI（送信済み招待の一覧、ステータス管理）
- [x] カレンダー同期の手動トリガーUI
- [x] イベント駆動アーキテクチャ（外部連携の非同期処理）
- [x] Dead Letter Queue (DLQ) による失敗イベントの管理

**進捗**: 約 85% 完了

---

### Phase 1.2A: LINE LIFF統合 [Next] 🔄

**目的**: LINE公式アカウント友達からの直接予約を実現

#### 実装内容

- [x] LIFF SDKの統合
- [x] `/liff/booking` ページの実装（既存コンポーネント流用）
- [x] LINEプロフィール自動取得・顧客データ紐付け
- [x] 予約確定後のLINE通知（既存フロー）

#### 完了定義 (DoD)

- [x] LINE公式アカウントから予約〜通知までのフロー完結（コード実装完了）
- [x] 既存のWeb予約と同等のUX
- [x] Service RoleクライアントでRLSバイパス
- [x] DB制約による顧客データの一意性保証
- [ ] LINEユーザーの70%がフォーム入力スキップ（プロフィール自動取得） - **実測待ち**
- [ ] 7日間連続無障害運用 - **運用開始待ち**

**進捗**: 約 90% 完了（実装完了、設定・運用開始待ち）

> ⚠️ **設定が必要です**: この機能を利用するには、[設定待ち項目](#-設定待ち項目要対応)セクションの「LINE LIFF統合」関連の設定を完了してください。

---

### Phase 1.2: Fintech & Communication Loop [Future] ⏳

**目的**: Stripe Connect 自動分配、LINE ネイティブ予約

#### 実装内容

- [ ] Stripe Connect 自動分配
- [ ] LINE ネイティブ予約（LIFF以外の方法）
- [ ] 手数料収益化率 100%
- [ ] リピート率 30% 以上

**進捗**: 0% 完了

---

### Phase 2.0: AI-Native FSM [Future] ⏳

**目的**: 24/7 AI 受付エージェント、AI 最適アサイン

#### 実装内容

- [ ] 24/7 AI 受付エージェント
- [ ] AI 最適アサイン
- [ ] スタッフ 1 人あたり売上の 2 倍向上
- [ ] AI 自動化率 70% 以上

**進捗**: 0% 完了

---

## ✅ Must Have機能の進捗

### A. 予約管理の基本機能

- [x] **オンライン予約受付**: 24時間365日、Web/LINE経由で予約を受け付ける
- [x] **空き枠計算**: リアルタイムで予約可能な日時を計算（キャンセル済み予約は除外必須）
- [x] **予約一覧・検索**: 店舗管理者が予約を一覧表示・検索できる
- [x] **予約詳細表示**: 顧客情報、サービス内容、日時、決済状況を確認できる
- [~] **予約の更新・キャンセル**: データベース直接編集で代替可能（UI実装は除外）

**進捗**: 100% 完了（UI実装除外は意図的）

### B. ステータス管理（最小限）

- [x] **2状態のみ**: `active`（有効）と `cancelled`（キャンセル済み）の2状態で管理
- [x] **空き枠計算でのキャンセル除外**: ダブルブッキング防止のため、`cancelled` ステータスの予約は空き枠計算から除外（必須）

**進捗**: 100% 完了

### C. 顧客管理

- [x] **顧客一覧**: 電話番号・名前で顧客を検索できる
- [x] **顧客詳細**: 予約履歴、累計利用額を確認できる
- [x] **家カルテ（住宅設備管理）**: エアコン、給湯器、水回りなどの設備情報を登録・管理できる

**進捗**: 100% 完了

### D. スタッフ・サービス管理

- [x] **スタッフ管理**: スタッフの登録・編集、指名料設定
- [x] **サービス管理**: メニューの登録・編集、価格・所要時間の設定

**進捗**: 100% 完了

### E. 決済機能

- [x] **オンライン事前決済**: Stripe経由でクレジットカード決済
- [x] **現地決済**: 作業完了後に現金/カードで支払い
- [x] **返金処理**: キャンセル時の返金処理（キャンセルポリシーに基づく）

**進捗**: 100% 完了

### F. 通知機能（基本）

- [x] **予約確定通知**: LINE/メールで予約確定を通知
- [~] **リマインド通知**: 前日リマインド（優先度：中）

**進捗**: 約 50% 完了（リマインド通知は未実装）

### G. 分析機能（基本）

- [x] **売上分析**: 日次・月次売上、メニュー別売上
- [x] **予約分析**: 予約数、キャンセル率、チャネル別分析
- [x] **リテンション分析**: 顧客維持率、LTV（顧客生涯価値）

**進捗**: 100% 完了

### H. 本部機能（HQ）

- [x] **店舗管理**: 全店舗の一覧、新規店舗作成
- [x] **請求管理**: 月次請求、手数料計算
- [x] **分析ダッシュボード**: 全店舗の売上、店舗ランキング

**進捗**: 100% 完了

### I. LIFF予約機能（Phase 1.2A）

- [x] **LIFF予約画面**: LINE内で予約フォームを表示
- [x] **プロフィール自動取得**: LINEユーザー名・アイコンを自動取得
- [x] **LINE通知**: 予約確定・リマインド通知をLINEで送信
- [x] **LINE IDと顧客の紐付け**: 初回予約時に自動紐付け

**進捗**: 100% 完了（実装完了、設定待ち）

---

## 📋 TODOリスト

### 🔄 進行中

- [ ] **Phase 1.2A: LINE LIFF統合の設定**
  - [ ] 環境変数 `NEXT_PUBLIC_LIFF_ID` の設定
  - [ ] LINE DevelopersでのLIFFアプリ作成
  - [ ] リッチメニューの設定
  - [ ] データベースマイグレーションの実行（`20260102_line_liff_integration.sql`）

- [ ] **リマインド通知の実装**
  - [ ] 前日リマインド通知の実装
  - [ ] Cronジョブの設定

### ⏳ 未着手（優先度高）

- [ ] **Phase 1.1の完了確認**
  - [ ] 7日間連続無障害運用の検証
  - [ ] パフォーマンステストの実施

### ⏳ 未着手（優先度中）

- [ ] **Phase 1.2: Fintech & Communication Loop**
  - [ ] Stripe Connect 自動分配の実装
  - [ ] LINE ネイティブ予約（LIFF以外）の検討

### ⏳ 未着手（優先度低・将来）

- [ ] **Phase 2.0: AI-Native FSM**
  - [ ] AI 受付エージェントの検討
  - [ ] AI 最適アサインの検討

---

## 🎯 Nice To Have機能（将来検討）

以下の機能は、Must Have が完璧に実装された後に検討する。

- [ ] **予約の更新・キャンセルUI**: データベース直接編集で代替可能
- [ ] **詳細なステータス管理**: `pending_payment`, `confirmed`, `working`, `completed` など（現状は `active`/`cancelled` で十分）
- [ ] **スタッフアサイン機能**: 予約にスタッフを手動割り当て（現状は自動割り当てで十分）
- [ ] **レビュー機能**: 顧客からのレビュー投稿・表示
- [ ] **スマート着信対応**: 不在着信時の自動SMS返信
- [ ] **AI最適アサイン**: スタッフのスキル・現在地を考慮した最適割り当て

---

## 📝 更新履歴

| 日付 | 更新内容 |
|:---|:---|
| 2026-01-02 | 設定待ち項目セクションを追加。設定が必要な項目を一覧表示できるように改善 |
| 2026-01-02 | 初版作成。Phase 1.2A（LINE LIFF統合）の実装完了を反映 |

---

## 🔗 関連ドキュメント

- [PRD (docs/prd.md)](prd.md) - プロダクト要件定義書
- [CHANGELOG (docs/CHANGELOG.md)](CHANGELOG.md) - 変更履歴
- [README (README.md)](../README.md) - プロジェクト概要

---

## 💡 使い方

1. **進捗確認**: 各セクションのチェックボックスで進捗を確認
2. **更新方法**: 
   - 機能実装完了時: `[ ]` を `[x]` に変更
   - 進行中: `[ ]` を `[~]` に変更（カスタム記号）
3. **TODO追加**: 「TODOリスト」セクションに新しいタスクを追加

**凡例**:
- `[x]` = 完了
- `[ ]` = 未完了
- `[~]` = 進行中
- `✅` = 完了（セクション全体）
- `🔄` = 進行中
- `⏳` = 未着手

